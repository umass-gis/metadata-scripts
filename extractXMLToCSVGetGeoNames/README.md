# Extract XML to CSV and Get GeoNames
This Python script iterates through multiple XML files generated by the [Export Metadata Multiple](https://desktop.arcgis.com/en/arcmap/latest/tools/conversion-toolbox/export-metadata-multiple.htm) tool in ArcMap. It retrieves each item's title and bounding coordinates, uses API queries to collect placename information from the [GeoNames](https://www.geonames.org) database, then generates a single CSV file with the aggregated information.

The script uses two APIs:
* [Cities and Placenames](https://www.geonames.org/export/JSON-webservices.html#citiesJSON) collects all the GeoName IDs of major populated places within a photo's bounding coordinates
* [Hierarchy](https://www.geonames.org/export/place-hierarchy.html#hierarchy) collects all the GeoName IDs of upper hierarchy of the most relevant populated place within the photo's bounding coordinates

These are the fields which are extracted and/or calculated:
* `mods_ID` - input to `dct_identifier_sm`
* `bbox` - input to `locn_geometry`, formatted as "ENVELOPE(W, E, N, S)"
* `geoname_ID` - input to `umass_geonames_s` (if found, otherwise 'none')
* `coverage` - input to `dct_spatial_sm` (if found, otherwise 'none')

## Customizations
`cols` - update this list with the column headings that should appear in the output CSV. These fields will need to be edited for the variable `this_df` as well.

`for citeinfo` and `for bounding` - these parts of the script use the xml.etree.ElementTree library to search for information within the XML file based on specific tags.
* For XML files with multiple children, see the Python docs help on [Parsing XML](https://docs.python.org/3/library/xml.etree.elementtree.html#parsing-xml)
* For locating buried elements in a tree, see the Python docs help on [XPath support](https://docs.python.org/3/library/xml.etree.elementtree.html#xpath-support)

`this_df` - there are two calculated fields in the present code, which take the extracted title and coordinate information and format it according to the GeoBlacklight Aaardvark metadata schema.

`username` - to use the GeoNames API, you must [create a GeoNames username](http://www.geonames.org/login).
