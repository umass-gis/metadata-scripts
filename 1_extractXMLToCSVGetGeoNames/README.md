# Extract XML to CSV and Get GeoNames
This Python script iterates through multiple XML files generated by the [Export Metadata Multiple](https://desktop.arcgis.com/en/arcmap/latest/tools/conversion-toolbox/export-metadata-multiple.htm) tool in ArcMap. It retrieves each item's title and bounding coordinates, uses API queries to collect placename information from the [GeoNames](https://www.geonames.org) database, then generates a single CSV file with the aggregated information.

The script uses two APIs:
* [Cities and Placenames](https://www.geonames.org/export/JSON-webservices.html#citiesJSON) collects all the GeoName IDs of major populated places within a photo's bounding coordinates
* [Hierarchy](https://www.geonames.org/export/place-hierarchy.html#hierarchy) collects all the GeoName IDs of upper hierarchy of the most relevant populated place within the photo's bounding coordinates

## Output Fields

These are the fields which are extracted and/or calculated:

| Field        | Description                                                      | Matching field in OGM Aardvark |
|:-------------|:-----------------------------------------------------------------|:-------------------------------|
| `mods_ID`    | Unique identifier                                                | `dct_identifier_sm`            |
| `spatial`    | Place names covered by the resource (if found, otherwise 'none') | `dct_spatial_sm`               |
| `geometry`   | Extent of the resource, formatted as "ENVELOPE(W, E, N, S)"      | `locn_geometry`                |
| `bbox`       | Bounding box, also formatted as "ENVELOPE(W, E, N, S)"           | `dcat_bbox`                    |
| `place`      | Populated Place from the GeoNames database                       |                                |
| `town`       | ADM3 from the GeoNames database                                  |                                |
| `county`     | ADM2 from the GeoNames database                                  |                                |
| `state`      | ADM1 from the GeoNames database                                  |                                |
| `geoname_ID` | GeoName IDs (if found, otherwise 'none')                         | `umass_geonames_s`             |


## Customizations
`cols` - update this list with the column headings that should appear in the output CSV. These fields will need to be edited for the variable `this_df` as well.

`citeinfo` and `bounding` - these parts of the script use the xml.etree.ElementTree library to search for information within the XML file based on specific tags.
* For XML files with multiple children, see the Python docs help on [Parsing XML](https://docs.python.org/3/library/xml.etree.elementtree.html#parsing-xml)
* For locating buried elements in a tree, see the Python docs help on [XPath support](https://docs.python.org/3/library/xml.etree.elementtree.html#xpath-support)

`spatial` - creates a list that rearranges the GeoNames parts into a custom format: `["Amherst, MA", "Town of Amherst, MA", "Hampshire County, MA"]`. These elements can be rearranged to create whatever format you prefer. See the [OGM Aaardvark](https://opengeometadata.org) metadata schema for more information about the `dct_spatial_sm` field.

`this_df` - there are several calculated fields that format the extracted title and coordinate information according to the [OGM Aaardvark](https://opengeometadata.org) metadata schema.

`username` - to use the GeoNames API, you must [create a GeoNames username](http://www.geonames.org/login). Running the script with the default username ("demo") will likely not return any results.
